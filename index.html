<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spin Sensory Wheel</title>
  <style>
    body {
      margin: 0;
      background: #0a0011;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      touch-action: none;
    }
    #muteBtn, #upgradeBtn, #babyLockBtn {
      position: absolute;
      right: 15px;
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      background: #222;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      z-index: 10;
    }
    #muteBtn { top: 15px; }
    #upgradeBtn { bottom: 60px; }
    #babyLockBtn { bottom: 100px; display: none; } /* hidden until upgrade */
    #volumeSlider {
      position: absolute;
      top: 55px;
      right: 15px;
      width: 120px;
      z-index: 10;
      display: none;
    }
    #instructions {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      color: #aaa;
      font-size: 12px;
      text-align: center;
      z-index: 10;
    }
    #toast {
      position: absolute;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.85);
      color: #fff;
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 14px;
      display: none;
      z-index: 20;
    }
  </style>
</head>
<body>
  <button id="muteBtn">ðŸ”Š Sound On</button>
  <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
  <button id="upgradeBtn">Upgrade for Baby Lock + No Ads Â· $5 for Life</button>
  <button id="babyLockBtn">Enable Baby Lock</button>
  <div id="instructions">Hold mute 3s for volume settings Â· Hold both Back + Overview buttons to exit Baby Lock</div>
  <div id="toast">Youâ€™re now ad free, and Baby Lock is available!</div>
  <canvas id="wheelCanvas"></canvas>

  <script>
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    const muteBtn = document.getElementById("muteBtn");
    const volumeSlider = document.getElementById("volumeSlider");
    const upgradeBtn = document.getElementById("upgradeBtn");
    const babyLockBtn = document.getElementById("babyLockBtn");
    const toast = document.getElementById("toast");

    let radius = 100;
    let audioCtx = null, masterGain = null, soundEnabled = true, volume = 0.5;
    let angle = 0, spinSpeed = 0, friction = 0.985;
    let isDragging = false, lastAngle = 0, lastTime = 0;
    let glowPulseTime = 0, lastSlice = null, lastSoundTime = 0;

    // Notes for do-re-mi scale
    const notes = [261.63,293.66,329.63,349.23,392.0,440.0,493.88,523.25];

    // Bubble system
    let bubbles = [];
    function createBubble() {
      bubbles.push({
        x: Math.random() * canvas.width,
        y: -50,
        r: 35 + Math.random() * 15,
        speed: 0.7 + Math.random() * 0.6,
        popped: false
      });
    }
    setInterval(() => {
      if (bubbles.length < 20) createBubble();
    }, 800);

    function drawBubbles() {
      bubbles.forEach((b, i) => {
        if (!b.popped) {
          ctx.beginPath();
          ctx.arc(b.x, b.y, b.r, 0, 2 * Math.PI);
          let grad = ctx.createRadialGradient(b.x, b.y, b.r*0.2, b.x, b.y, b.r);
          grad.addColorStop(0, "rgba(255,255,255,0.7)");
          grad.addColorStop(0.5, "rgba(173,216,230,0.3)");
          grad.addColorStop(1, "rgba(255,255,255,0.1)");
          ctx.fillStyle = grad;
          ctx.fill();
          b.y += b.speed;
          if (b.y - b.r > canvas.height) bubbles.splice(i,1);
        }
      });
    }

    canvas.addEventListener("click", e => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left, y = e.clientY - rect.top;
      bubbles.forEach(b => {
        if (!b.popped) {
          const dist = Math.hypot(b.x - x, b.y - y);
          if (dist < b.r) {
            b.popped = true;
            playBubbleNote();
          }
        }
      });
    });

    let bubbleNoteIndex = 0;
    function playBubbleNote() {
      if (!soundEnabled) return;
      if (!audioCtx) {
        audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        masterGain = audioCtx.createGain();
        masterGain.gain.value = volume;
        masterGain.connect(audioCtx.destination);
      }
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = "sine";
      osc.frequency.setValueAtTime(notes[bubbleNoteIndex], audioCtx.currentTime);
      gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
      osc.connect(gain);
      gain.connect(masterGain);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.3);
      bubbleNoteIndex = (bubbleNoteIndex + 1) % notes.length;
    }

    // Resize
    function resizeCanvas(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      radius = Math.min(canvas.width, canvas.height) * 0.45;
    }
    window.addEventListener("resize", resizeCanvas);

    // Wheel
    function drawWheel(){
      ctx.save();
      ctx.translate(canvas.width/2, canvas.height/2);
      ctx.rotate(angle);

      glowPulseTime += 0.02;
      const pulse = 50 + Math.sin(glowPulseTime) * 10;

      const colors = ["#ff007f","#ff7f00","#ffff00","#00ff00","#00ffff","#0000ff","#8b00ff"];
      for (let i=0;i<colors.length;i++) {
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.arc(0,0,radius,(i*2*Math.PI)/colors.length,((i+1)*2*Math.PI)/colors.length);
        ctx.closePath();
        ctx.fillStyle = colors[i];
        ctx.shadowColor = colors[i];
        ctx.shadowBlur = pulse;
        ctx.fill();
      }
      ctx.restore();
    }

    function animate(){
      if (!isDragging) {
        angle += spinSpeed;
        spinSpeed *= friction;
      }
      const normalized = ((angle % (2*Math.PI)) + 2*Math.PI) % (2*Math.PI);
      const currentSlice = Math.floor((normalized / (2*Math.PI)) * 7);
      const now = performance.now();
      if (currentSlice !== lastSlice && Math.abs(spinSpeed) > 0.05 && now - lastSoundTime > 100) {
        const idx = spinSpeed > 0 ? currentSlice : (7-currentSlice);
        playTone(notes[idx],0.25);
        lastSlice = currentSlice;
        lastSoundTime = now;
      }

      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawBubbles();
      drawWheel();
      requestAnimationFrame(animate);
    }

    function playTone(freq,duration){
      if (!soundEnabled) return;
      if (!audioCtx) {
        audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        masterGain = audioCtx.createGain();
        masterGain.gain.value = volume;
        masterGain.connect(audioCtx.destination);
      }
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = "sine";
      osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
      gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
      osc.connect(gain);
      gain.connect(masterGain);
      osc.start();
      osc.stop(audioCtx.currentTime + duration);
    }

    function getPointerAngle(x,y){
      const r=canvas.getBoundingClientRect();
      const cx=r.left+canvas.width/2, cy=r.top+canvas.height/2;
      return Math.atan2(y-cy,x-cx);
    }
    function pointerDown(e){
      isDragging=true;
      lastAngle=getPointerAngle(e.clientX||e.touches[0].clientX, e.clientY||e.touches[0].clientY);
      lastTime=Date.now();
      spinSpeed=0;
    }
    function pointerMove(e){
      if(!isDragging) return;
      const a=getPointerAngle(e.clientX||e.touches[0].clientX, e.clientY||e.touches[0].clientY);
      const now=Date.now();
      const delta=a-lastAngle;
      angle+=delta;
      spinSpeed=delta/((now-lastTime)/1000);
      lastAngle=a; lastTime=now;
    }
    function pointerUp(){ isDragging=false; }

    muteBtn.onclick=()=>{
      soundEnabled=!soundEnabled;
      muteBtn.textContent=soundEnabled?"ðŸ”Š Sound On":"ðŸ”‡ Sound Off";
    };
    let muteHoldTimer=null;
    muteBtn.addEventListener("mousedown",()=>{
      muteHoldTimer=setTimeout(()=>{volumeSlider.style.display="block";},3000);
    });
    muteBtn.addEventListener("mouseup",()=>clearTimeout(muteHoldTimer));

    volumeSlider.oninput=e=>{
      volume=parseFloat(e.target.value);
      if(masterGain){ masterGain.gain.value=volume; }
    };

    canvas.addEventListener("mousedown",pointerDown);
    canvas.addEventListener("mousemove",pointerMove);
    canvas.addEventListener("mouseup",pointerUp);
    canvas.addEventListener("touchstart",pointerDown);
    canvas.addEventListener("touchmove",pointerMove);
    canvas.addEventListener("touchend",pointerUp);

    // Upgrade button â†’ enable Baby Lock + show toast
    upgradeBtn.onclick=()=>{
      upgradeBtn.style.display="none";
      babyLockBtn.style.display="block"; // show only after upgrade
      showToast("Youâ€™re now ad free, and Baby Lock is available!");
    };

    function showToast(msg){
      toast.textContent = msg;
      toast.style.display="block";
      setTimeout(()=>{ toast.style.display="none"; }, 4000);
    }

    // Init
    resizeCanvas();
    animate();
  </script>
</body>
</html>
