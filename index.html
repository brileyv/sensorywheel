<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spin Sensory Wheel</title>
  <style>
    body { margin:0; background:#0a0011; overflow:hidden; }
    canvas { display:block; touch-action:none; }
    #muteBtn, #upgradeBtn {
      position:absolute; right:15px; padding:10px 18px;
      border:none; border-radius:20px; background:#fff;
      box-shadow:0 0 8px rgba(0,0,0,0.4); font-size:16px; cursor:pointer;
      z-index:10;
    }
    #muteBtn { top:15px; }
    #volumeSlider { position:absolute; top:60px; right:15px; width:150px; z-index:10; }
    #upgradeBtn { bottom:15px; font-size:14px; background:linear-gradient(90deg,#6a5acd,#ff69b4); color:#fff; }
  </style>
</head>
<body>
  <button id="muteBtn">ðŸ”Š Sound On</button>
  <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
  <button id="upgradeBtn">Upgrade for Baby Lock + No Ads Â· $5 for Life</button>
  <canvas id="wheelCanvas"></canvas>

  <script>
    const canvas=document.getElementById("wheelCanvas"),ctx=canvas.getContext("2d");
    const muteBtn=document.getElementById("muteBtn"),volumeSlider=document.getElementById("volumeSlider");

    let radius=100,audioCtx=null,masterGain=null,soundEnabled=true,volume=0.5;
    let angle=0,spinSpeed=0,friction=0.985,isDragging=false,lastAngle=0,lastTime=0,glowPulseTime=0,lastSlice=null,lastSoundTime=0;

    const colors=["#ff007f","#ff7f00","#ffff00","#00ff00","#00ffff","#0000ff","#8b00ff"];
    const notes=[261.63,293.66,329.63,349.23,392.0,440.0,493.88,523.25]; // do-re-mi-fa-so-la-ti-do

    // --- Bubbles ---
    let bubbles=[];
    function createBubble(){
      const r=70+Math.random()*20;
      const x=Math.random()*(canvas.width-r*2)+r;
      return {x,y:-r,r,speed:0.7+Math.random()*1.2,popped:false,tint:randomTint()};
    }
    function randomTint(){
      const tints=[
        "rgba(255,0,255,0.4)","rgba(0,255,255,0.4)",
        "rgba(0,255,128,0.4)","rgba(255,255,0,0.4)"
      ];
      return tints[Math.floor(Math.random()*tints.length)];
    }
    function drawBubbles(){
      bubbles.forEach((b,i)=>{
        if(!b.popped){
          const grad=ctx.createRadialGradient(b.x,b.y,b.r*0.2,b.x,b.y,b.r);
          grad.addColorStop(0,"rgba(255,255,255,0.05)");
          grad.addColorStop(0.7,"rgba(200,255,255,0.08)");
          grad.addColorStop(0.95,b.tint);
          grad.addColorStop(1,"rgba(255,255,255,0.5)");

          ctx.beginPath();
          ctx.arc(b.x,b.y,b.r,0,2*Math.PI);
          ctx.fillStyle=grad;
          ctx.fill();

          b.y+=b.speed;
          if(b.y-b.r>canvas.height){
            bubbles[i]=createBubble();
          }
        }
      });
    }
    setInterval(()=>{ if(bubbles.length<20) bubbles.push(createBubble()); },600);

    canvas.addEventListener("click",e=>{
      const rect=canvas.getBoundingClientRect();
      const x=e.clientX-rect.left,y=e.clientY-rect.top;
      bubbles.forEach((b,i)=>{
        if(!b.popped){
          const dist=Math.hypot(b.x-x,b.y-y);
          if(dist<b.r){
            b.popped=true;
            playPopNote();
            bubbles[i]=createBubble();
          }
        }
      });
    });

    // --- Bubble sounds ---
    let bubbleNoteIndex=0;
    function playPopNote(){
      const freq=notes[bubbleNoteIndex];
      playTone(freq,0.25,"sine");
      bubbleNoteIndex=(bubbleNoteIndex+1)%notes.length;
    }

    // --- Wheel ---
    function resizeCanvas(){
      canvas.width=window.innerWidth; canvas.height=window.innerHeight;
      const m=Math.min(canvas.width,canvas.height);
      radius=m*0.45;
    }
    window.addEventListener("resize",resizeCanvas);

    function drawWheel(){
      ctx.save();
      ctx.translate(canvas.width/2,canvas.height/2);
      ctx.rotate(angle);
      glowPulseTime+=0.02;
      const pulse=50+Math.sin(glowPulseTime)*10;

      ctx.beginPath();
      ctx.arc(0,0,radius+12,0,2*Math.PI);
      ctx.strokeStyle="white"; ctx.lineWidth=4;
      ctx.shadowColor="white"; ctx.shadowBlur=pulse*1.5;
      ctx.stroke();

      for(let i=0;i<colors.length;i++){
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.arc(0,0,radius,(i*2*Math.PI)/colors.length,((i+1)*2*Math.PI)/colors.length);
        ctx.closePath();
        ctx.fillStyle=colors[i];
        ctx.shadowColor=colors[i];
        ctx.shadowBlur=pulse;
        ctx.fill();
      }
      ctx.restore();
    }

    function animate(){
      if(!isDragging){ angle+=spinSpeed; spinSpeed*=friction; }
      const normalized=((angle%(2*Math.PI))+2*Math.PI)%(2*Math.PI);
      const currentSlice=Math.floor((normalized/(2*Math.PI))*colors.length);
      const now=performance.now();

      if(currentSlice!==lastSlice && Math.abs(spinSpeed)>0.05 && now-lastSoundTime>120){
        if(spinSpeed>0){ // clockwise = forward
          playTone(notes[wheelIndex],"sine",0.3);
          wheelIndex=(wheelIndex+1)%notes.length;
        } else { // counterclockwise = backward
          wheelIndex=(wheelIndex-1+notes.length)%notes.length;
          playTone(notes[wheelIndex],"triangle",0.3);
        }
        lastSlice=currentSlice; lastSoundTime=now;
      }

      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawBubbles();
      drawWheel();
      requestAnimationFrame(animate);
    }

    // --- Wheel sounds ---
    let wheelIndex=0;
    function playTone(freq,duration,type){
      if(!soundEnabled) return;
      if(!audioCtx){
        audioCtx=new (window.AudioContext||window.webkitAudioContext)();
        masterGain=audioCtx.createGain();
        masterGain.gain.value=volume;
        masterGain.connect(audioCtx.destination);
      }
      const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();
      osc.type=type;
      osc.frequency.setValueAtTime(freq,audioCtx.currentTime);
      gain.gain.setValueAtTime(0.2,audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+duration);
      osc.connect(gain); gain.connect(masterGain);
      osc.start(); osc.stop(audioCtx.currentTime+duration);
    }

    // --- Controls ---
    function getPointerAngle(x,y){
      const cx=canvas.width/2,cy=canvas.height/2;
      return Math.atan2(y-cy,x-cx);
    }
    function pointerDown(e){
      isDragging=true;
      lastAngle=getPointerAngle(e.clientX||e.touches[0].clientX,e.clientY||e.touches[0].clientY);
      lastTime=Date.now(); spinSpeed=0;
    }
    function pointerMove(e){
      if(!isDragging) return;
      const a=getPointerAngle(e.clientX||e.touches[0].clientX,e.clientY||e.touches[0].clientY);
      const now=Date.now(),delta=a-lastAngle;
      angle+=delta; spinSpeed=delta/((now-lastTime)/1000);
      lastAngle=a; lastTime=now;
    }
    function pointerUp(){ isDragging=false; }

    muteBtn.onclick=()=>{ soundEnabled=!soundEnabled; muteBtn.textContent=soundEnabled?"ðŸ”Š Sound On":"ðŸ”‡ Sound Off"; };
    volumeSlider.oninput=e=>{ volume=parseFloat(e.target.value); if(masterGain) masterGain.gain.value=volume; };

    canvas.addEventListener("mousedown",pointerDown);
    canvas.addEventListener("mousemove",pointerMove);
    canvas.addEventListener("mouseup",pointerUp);
    canvas.addEventListener("touchstart",pointerDown);
    canvas.addEventListener("touchmove",pointerMove);
    canvas.addEventListener("touchend",pointerUp);

    resizeCanvas();
    for(let i=0;i<12;i++) bubbles.push(createBubble());
    animate();
  </script>
</body>
</html>
