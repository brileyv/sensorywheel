<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spin Sensory Wheel</title>
  <style>
    body { margin:0; background:#0a0011; overflow:hidden; }
    canvas { display:block; touch-action:none; }
    #muteBtn, #upgradeBtn {
      position:absolute; right:15px; padding:10px 18px;
      border:none; border-radius:20px; background:#fff;
      box-shadow:0 0 6px rgba(0,0,0,0.3); font-size:16px; cursor:pointer;
    }
    #muteBtn { top:15px; }
    #volumeSlider { position:absolute; top:65px; right:15px; width:150px; }
    #upgradeBtn { bottom:15px; font-size:15px; }
  </style>
</head>
<body>
  <button id="muteBtn">ðŸ”Š Sound On</button>
  <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
  <button id="upgradeBtn">Upgrade for Baby Lock + No Ads Â· $5 for Life</button>
  <canvas id="wheelCanvas"></canvas>
  <script>
const canvas=document.getElementById("wheelCanvas"),ctx=canvas.getContext("2d");
const muteBtn=document.getElementById("muteBtn"),volumeSlider=document.getElementById("volumeSlider");

let radius=100,audioCtx=null,masterGain=null,soundEnabled=true,volume=0.5;
let angle=0,spinSpeed=0,friction=0.985,isDragging=false,lastAngle=0,lastTime=0;
let glowPulseTime=0,lastSlice=null,lastSoundTime=0;
let activeFingerId=null;

// Colors + notes for wheel
const colors=["#ff007f","#ff7f00","#ffff00","#00ff00","#00ffff","#0000ff","#8b00ff"];
const notes=[261.63,293.66,329.63,392.0,440.0,493.88,523.25]; // do-re-mi

// --- Bubble system ---
let bubbles=[];
const maxBubbles=25;
const minSize=25,maxSize=45;
const minSpeed=0.4,maxSpeed=1.1;

function newBubble(){
  let safe=false,bubble,attempts=0;
  while(!safe && attempts<100){
    bubble={
      x:Math.random()*(canvas.width-maxSize*2)+maxSize,
      y:-Math.random()*canvas.height,
      r:minSize+Math.random()*(maxSize-minSize),
      vy:minSpeed+Math.random()*(maxSpeed-minSpeed)
    };
    safe=true;
    for(let other of bubbles){
      const dist=Math.hypot(bubble.x-other.x,bubble.y-other.y);
      if(dist<bubble.r+other.r+25){ safe=false; break; }
    }
    attempts++;
  }
  return bubble;
}

function drawBubbles(){
  bubbles.forEach((b,i)=>{
    b.y+=b.vy;
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,2*Math.PI);
    ctx.fillStyle="rgba(200,255,255,0.15)";
    ctx.strokeStyle="rgba(255,255,255,0.4)";
    ctx.lineWidth=2;
    ctx.fill(); ctx.stroke();
    if(b.y-b.r>canvas.height){
      // stagger respawn
      setTimeout(()=>{ bubbles[i]=newBubble(); },Math.random()*1500);
    }
  });
}

function playBubblePop(){
  if(!soundEnabled||!audioCtx) return;
  const freq=[261.63,293.66,329.63,392.0,440.0,493.88,523.25][bubbleNote%8];
  bubbleNote++;
  const osc=audioCtx.createOscillator();
  const gain=audioCtx.createGain();
  osc.type="sine";
  osc.frequency.value=freq;
  gain.gain.setValueAtTime(0.25,audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.25);
  osc.connect(gain); gain.connect(masterGain);
  osc.start(); osc.stop(audioCtx.currentTime+0.25);
}
let bubbleNote=0;

canvas.addEventListener("click",e=>{
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left, y=e.clientY-rect.top;
  bubbles.forEach((b,i)=>{
    if(Math.hypot(b.x-x,b.y-y)<b.r){
      playBubblePop();
      bubbles[i]=newBubble();
    }
  });
});

// --- Wheel ---
function resizeCanvas(){
  canvas.width=window.innerWidth||600;
  canvas.height=window.innerHeight||600;
  const m=Math.min(canvas.width,canvas.height);
  radius=(m>0?m:600)*0.45;
}
window.addEventListener("resize",resizeCanvas);

function getPointerAngle(x,y){
  const r=canvas.getBoundingClientRect(),
        cx=canvas.width/2,cy=canvas.height/2;
  return Math.atan2(y-cy,x-cx);
}

function drawWheel(){
  ctx.save();
  ctx.translate(canvas.width/2,canvas.height/2);
  ctx.rotate(angle);
  glowPulseTime+=0.02;
  const pulse=50+Math.sin(glowPulseTime)*10;
  ctx.beginPath();
  ctx.arc(0,0,radius+12,0,2*Math.PI);
  ctx.strokeStyle="white"; ctx.lineWidth=4;
  ctx.shadowColor="white"; ctx.shadowBlur=pulse*1.5;
  ctx.stroke();
  for(let i=0;i<colors.length;i++){
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,radius,(i*2*Math.PI)/colors.length,((i+1)*2*Math.PI)/colors.length);
    ctx.closePath();
    ctx.fillStyle=colors[i];
    ctx.shadowColor=colors[i]; ctx.shadowBlur=pulse;
    ctx.fill();
  }
  ctx.restore();
}

function animate(){
  if(!isDragging){ angle+=spinSpeed; spinSpeed*=friction; }
  const normalized=((angle%(2*Math.PI))+2*Math.PI)%(2*Math.PI);
  const currentSlice=Math.floor((normalized/(2*Math.PI))*colors.length);
  const now=performance.now();
  if(currentSlice!==lastSlice && Math.abs(spinSpeed)>0.05 && now-lastSoundTime>100){
    let idx=(spinSpeed>0)?currentSlice:(colors.length-currentSlice-1);
    playTone(notes[idx%notes.length],0.25,"sine");
    lastSlice=currentSlice; lastSoundTime=now;
  }
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBubbles();
  drawWheel();
  requestAnimationFrame(animate);
}

function playTone(freq,duration,type){
  if(!soundEnabled) return;
  if(!audioCtx){
    audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    masterGain=audioCtx.createGain(); masterGain.gain.value=volume;
    masterGain.connect(audioCtx.destination);
  }
  const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();
  osc.type=type; osc.frequency.value=freq;
  gain.gain.setValueAtTime(0.15,audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+duration);
  osc.connect(gain); gain.connect(masterGain);
  osc.start(); osc.stop(audioCtx.currentTime+duration);
}

function pointerDown(e){
  const rect=canvas.getBoundingClientRect();
  const x=(e.clientX|| (e.touches&&e.touches[0].clientX))-rect.left;
  const y=(e.clientY|| (e.touches&&e.touches[0].clientY))-rect.top;
  const dx=x-canvas.width/2,dy=y-canvas.height/2;
  if(Math.hypot(dx,dy)<=radius && activeFingerId===null){
    isDragging=true;
    activeFingerId=e.pointerId||(e.changedTouches&&e.changedTouches[0].identifier);
    lastAngle=getPointerAngle(x,y); lastTime=Date.now(); spinSpeed=0;
  }
}
function pointerMove(e){
  if(!isDragging) return;
  const rect=canvas.getBoundingClientRect();
  const x=(e.clientX||(e.touches&&e.touches[0].clientX))-rect.left;
  const y=(e.clientY||(e.touches&&e.touches[0].clientY))-rect.top;
  const a=getPointerAngle(x,y),now=Date.now(),delta=a-lastAngle;
  angle+=delta; spinSpeed=delta/((now-lastTime)/1000);
  lastAngle=a; lastTime=now;
}
function pointerUp(){ isDragging=false; activeFingerId=null; }

muteBtn.onclick=()=>{ soundEnabled=!soundEnabled; muteBtn.textContent=soundEnabled?"ðŸ”Š Sound On":"ðŸ”‡ Sound Off"; };
volumeSlider.oninput=e=>{ volume=parseFloat(e.target.value); if(masterGain) masterGain.gain.value=volume; };

canvas.addEventListener("mousedown",pointerDown);
canvas.addEventListener("mousemove",pointerMove);
canvas.addEventListener("mouseup",pointerUp);
canvas.addEventListener("touchstart",pointerDown);
canvas.addEventListener("touchmove",pointerMove);
canvas.addEventListener("touchend",pointerUp);

// Init
window.onload=()=>{
  resizeCanvas();
  for(let i=0;i<maxBubbles;i++){ bubbles.push(newBubble()); }
  animate();
};
</script>
</body>
</html>
