<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spin Sensory Wheel</title>
  <style>
    body { margin:0; background:#0a0011; overflow:hidden; }
    canvas { display:block; touch-action:none; }
    #muteBtn, #upgradeBtn {
      position:absolute; right:15px; padding:10px 18px;
      border:none; border-radius:20px; background:#fff;
      box-shadow:0 0 6px rgba(0,0,0,0.3); font-size:16px; cursor:pointer;
    }
    #muteBtn { top:15px; }
    #volumeSlider { position:absolute; top:65px; right:15px; width:150px; }
    #upgradeBtn { bottom:15px; font-size:15px; }
  </style>
</head>
<body>
  <button id="muteBtn">ðŸ”Š Sound On</button>
  <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
  <button id="upgradeBtn">Upgrade for Baby Lock + No Ads Â· $5 for Life</button>
  <canvas id="wheelCanvas"></canvas>

  <script>
  const canvas=document.getElementById("wheelCanvas"),ctx=canvas.getContext("2d");
  const muteBtn=document.getElementById("muteBtn"),volumeSlider=document.getElementById("volumeSlider");

  let radius=100,audioCtx=null,masterGain=null,soundEnabled=true,volume=0.5;
  let angle=0,spinSpeed=0,friction=0.985,isDragging=false,lastAngle=0,lastTime=0;
  let glowPulseTime=0,lastSlice=null,lastSoundTime=0;
  let activeFingerId=null;

  // Full C major scale: C D E F G A B C
  const scale=[261.63,293.66,329.63,349.23,392.0,440.0,493.88,523.25];
  let wheelIndex=0;
  let bubbleIndex=0;

  // Wheel colors
  const colors=["#ff007f","#ff7f00","#ffff00","#00ff00","#00ffff","#0000ff","#8b00ff"];

  // --- Bubbles ---
  let bubbles=[];
  const maxBubbles=25;
  const minSize=50,maxSize=90;
  const minSpeed=0.5,maxSpeed=1.2;

  function newBubble(){
    return {
      x:Math.random()*(canvas.width-maxSize*2)+maxSize,
      y:-Math.random()*canvas.height,
      r:minSize+Math.random()*(maxSize-minSize),
      vy:minSpeed+Math.random()*(maxSpeed-minSpeed)
    };
  }

  function drawBubbles(){
    bubbles.forEach((b,i)=>{
      b.y+=b.vy;

      // Realistic bubble gradient
      const g=ctx.createRadialGradient(b.x-b.r*0.3,b.y-b.r*0.3,b.r*0.1,b.x,b.y,b.r);
      g.addColorStop(0,"rgba(255,255,255,0.9)");
      g.addColorStop(0.3,"rgba(200,255,255,0.4)");
      g.addColorStop(1,"rgba(200,255,255,0.05)");

      ctx.beginPath();
      ctx.arc(b.x,b.y,b.r,0,2*Math.PI);
      ctx.fillStyle=g;
      ctx.fill();

      if(b.y-b.r>canvas.height){
        setTimeout(()=>{ bubbles[i]=newBubble(); },Math.random()*1200);
      }
    });
  }

  // --- Sounds ---
  function ensureAudio(){
    if(!audioCtx){
      audioCtx=new (window.AudioContext||window.webkitAudioContext)();
      masterGain=audioCtx.createGain(); masterGain.gain.value=volume;
      masterGain.connect(audioCtx.destination);
    }
  }

  function playNote(freq,type="sine",dur=0.4){
    if(!soundEnabled) return;
    ensureAudio();
    const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();
    osc.type=type; osc.frequency.value=freq;
    gain.gain.setValueAtTime(0.2,audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+dur);
    osc.connect(gain); gain.connect(masterGain);
    osc.start(); osc.stop(audioCtx.currentTime+dur);
  }

  function playBubblePop(){
    playNote(scale[bubbleIndex],"sine",0.25);
    bubbleIndex=(bubbleIndex+1)%scale.length;
  }

  // --- Wheel ---
  function resizeCanvas(){
    canvas.width=window.innerWidth||600;
    canvas.height=window.innerHeight||600;
    radius=Math.min(canvas.width,canvas.height)*0.45;
  }
  window.addEventListener("resize",resizeCanvas);

  function getPointerAngle(x,y){
    const cx=canvas.width/2,cy=canvas.height/2;
    return Math.atan2(y-cy,x-cx);
  }

  function drawWheel(){
    ctx.save();
    ctx.translate(canvas.width/2,canvas.height/2);
    ctx.rotate(angle);
    glowPulseTime+=0.02;
    const pulse=50+Math.sin(glowPulseTime)*10;
    ctx.beginPath();
    ctx.arc(0,0,radius+12,0,2*Math.PI);
    ctx.strokeStyle="white"; ctx.lineWidth=4;
    ctx.shadowColor="white"; ctx.shadowBlur=pulse*1.5;
    ctx.stroke();
    for(let i=0;i<colors.length;i++){
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0,radius,(i*2*Math.PI)/colors.length,((i+1)*2*Math.PI)/colors.length);
      ctx.closePath();
      ctx.fillStyle=colors[i];
      ctx.shadowColor=colors[i]; ctx.shadowBlur=pulse;
      ctx.fill();
    }
    ctx.restore();
  }

  function animate(){
    if(!isDragging){ angle+=spinSpeed; spinSpeed*=friction; }
    const normalized=((angle%(2*Math.PI))+2*Math.PI)%(2*Math.PI);
    const currentSlice=Math.floor((normalized/(2*Math.PI))*colors.length);
    const now=performance.now();

    if(currentSlice!==lastSlice && Math.abs(spinSpeed)>0.05 && now-lastSoundTime>120){
      if(spinSpeed>0){
        playNote(scale[wheelIndex],"sine",0.3);
        wheelIndex=(wheelIndex+1)%scale.length;
      }else{
        wheelIndex=(wheelIndex-1+scale.length)%scale.length;
        playNote(scale[wheelIndex],"triangle",0.3);
      }
      lastSlice=currentSlice;
      lastSoundTime=now;
    }

    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawBubbles();
    drawWheel();
    requestAnimationFrame(animate);
  }

  // --- Controls ---
  function pointerDown(e){
    const rect=canvas.getBoundingClientRect();
    const x=(e.clientX||(e.touches&&e.touches[0].clientX))-rect.left;
    const y=(e.clientY||(e.touches&&e.touches[0].clientY))-rect.top;
    const dx=x-canvas.width/2,dy=y-canvas.height/2;
    if(Math.hypot(dx,dy)<=radius && activeFingerId===null){
      isDragging=true;
      activeFingerId=e.pointerId||(e.changedTouches&&e.changedTouches[0].identifier);
      lastAngle=getPointerAngle(x,y); lastTime=Date.now(); spinSpeed=0;
    }
    bubbles.forEach((b,i)=>{
      if(Math.hypot(b.x-x,b.y-y)<b.r){
        playBubblePop();
        bubbles[i]=newBubble();
      }
    });
  }
  function pointerMove(e){
    if(!isDragging) return;
    const rect=canvas.getBoundingClientRect();
    const x=(e.clientX||(e.touches&&e.touches[0].clientX))-rect.left;
    const y=(e.clientY||(e.touches&&e.touches[0].clientY))-rect.top;
    const a=getPointerAngle(x,y),now=Date.now(),delta=a-lastAngle;
    angle+=delta; spinSpeed=delta/((now-lastTime)/1000);
    lastAngle=a; lastTime=now;
  }
  function pointerUp(){ isDragging=false; activeFingerId=null; }

  muteBtn.onclick=()=>{ soundEnabled=!soundEnabled; muteBtn.textContent=soundEnabled?"ðŸ”Š Sound On":"ðŸ”‡ Sound Off"; };
  volumeSlider.oninput=e=>{ volume=parseFloat(e.target.value); if(masterGain) masterGain.gain.value=volume; };

  canvas.addEventListener("mousedown",pointerDown);
  canvas.addEventListener("mousemove",pointerMove);
  canvas.addEventListener("mouseup",pointerUp);
  canvas.addEventListener("touchstart",pointerDown);
  canvas.addEventListener("touchmove",pointerMove);
  canvas.addEventListener("touchend",pointerUp);

  // Init
  window.onload=()=>{
    resizeCanvas();
    for(let i=0;i<maxBubbles;i++){ bubbles.push(newBubble()); }
    animate();
  };
  </script>
</body>
</html>
