<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spin Sensory Wheel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: dark; }
    body { margin:0; background:#0a0011; overflow:hidden; font-family: system-ui, sans-serif; }
    canvas { display:block; touch-action:none; }

    /* Controls area */
    #controls {
      position:absolute; bottom:50px; left:50%; transform:translateX(-50%);
      z-index:10; display:flex; justify-content:center;
    }
    #upgradeBtn, #babyLockBtn {
      padding:14px 22px; border:0; border-radius:28px;
      background:linear-gradient(90deg,#6a5acd,#ff69b4); 
      color:#fff; font-weight:600; font-size:15px;
      box-shadow:0 6px 18px rgba(0,0,0,.35);
      text-align:center; white-space:nowrap;
    }
    #babyLockBtn { display:none; }

    /* Instructions */
    #instructions {
      position:absolute; bottom:6px; left:0; right:0;
      text-align:center; font-size:12px; color:rgba(255,255,255,0.5);
      pointer-events:none; line-height:1.4;
    }

    /* Lock Icon */
    #lockIcon {
      position:absolute; top:10px; left:50%; transform:translateX(-50%);
      font-size:22px; color:#fff; opacity:0.7; display:none; pointer-events:none;
    }

    /* Volume controls */
    #volumePanel {
      position:absolute; top:10px; left:10px; z-index:20;
      display:none; flex-direction:row; align-items:center; gap:10px;
      background:rgba(0,0,0,0.6); padding:8px; border-radius:12px;
    }
    #volumeBtn { font-size:22px; color:white; background:none; border:none; cursor:default; }
    #volumeSlider { width:140px; }
    #closeVolume {
      background:red; color:white; border:none; border-radius:50%;
      width:28px; height:28px; font-size:16px; cursor:pointer;
    }

    /* Toast */
    #toast {
      position:fixed; bottom:100px; left:50%; transform:translateX(-50%);
      background:rgba(30,30,30,0.95); color:#fff; padding:8px 14px;
      border-radius:16px; font-size:13px;
      box-shadow:0 4px 12px rgba(0,0,0,0.3);
      opacity:0; transition:opacity .3s ease; pointer-events:none;
      z-index:100;
    }
    #toast.show { opacity:1; }
  </style>
</head>
<body>
  <!-- Volume Controls -->
  <div id="volumePanel">
    <button id="volumeBtn">ðŸ”Š</button>
    <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="0.6" />
    <button id="closeVolume">âœ•</button>
  </div>

  <!-- Controls -->
  <div id="controls">
    <button id="upgradeBtn">Upgrade for Baby Lock + No Ads Â· $5 for Life</button>
    <button id="babyLockBtn">Enable Baby Lock</button>
  </div>

  <!-- Instructions -->
  <div id="instructions">
    Hold top left corner 3s for volume settings<br>
    Hold both top corners 3s to exit Baby Lock
  </div>

  <!-- Lock Icon + Toast -->
  <div id="lockIcon">ðŸ”’</div>
  <div id="toast"></div>
  <canvas id="wheelCanvas"></canvas>

  <script>
  const canvas=document.getElementById("wheelCanvas"),ctx=canvas.getContext("2d");
  const upgradeBtn=document.getElementById("upgradeBtn");
  const babyLockBtn=document.getElementById("babyLockBtn");
  const lockIcon=document.getElementById("lockIcon");
  const volumePanel=document.getElementById("volumePanel");
  const volumeSlider=document.getElementById("volumeSlider");
  const closeVolume=document.getElementById("closeVolume");
  const toast=document.getElementById("toast");

  /* ---- Toast ---- */
  let toastTimer;
  function showToast(msg){
    toast.textContent=msg;
    toast.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer=setTimeout(()=>toast.classList.remove("show"),1500);
  }

  /* ---- Upgrade ---- */
  let upgraded=false, lockActive=false;
  upgradeBtn.onclick=()=>{
    alert("You're now ad-free, and Baby Lock is available!");
    upgraded=true;
    upgradeBtn.style.display="none";
    babyLockBtn.style.display="block"; // show Baby Lock button
  };

  babyLockBtn.onclick=()=>{
    enableBabyLock();
    babyLockBtn.style.display="none"; // hide button once enabled
  };

  function enableBabyLock(){
    lockActive=true;
    lockIcon.style.display="block";
    showToast("Baby Lock Enabled");
  }
  function disableBabyLock(){
    lockActive=false;
    lockIcon.style.display="none";
    showToast("Baby Lock Disabled");
    babyLockBtn.style.display="block"; // allow re-enabling
  }

  /* ---- Unlock gesture ---- */
  let touches={}, timer=null;
  canvas.addEventListener("touchstart",e=>{
    for(const t of e.touches){
      if(t.clientY<80){
        if(t.clientX<80) touches.left=true;
        if(t.clientX>window.innerWidth-80) touches.right=true;
      }
    }
    if(touches.left && touches.right && lockActive && !timer){
      timer=setTimeout(()=>disableBabyLock(),3000);
    }
  });
  canvas.addEventListener("touchend",()=>{touches={};clearTimeout(timer);timer=null;});

  /* ---- Volume ---- */
  let audioCtx=null, masterGain=null, volume=parseFloat(volumeSlider.value);
  function ensureAudio(){
    if(!audioCtx){
      audioCtx=new (window.AudioContext||window.webkitAudioContext)();
      masterGain=audioCtx.createGain();
      masterGain.gain.value=volume;
      masterGain.connect(audioCtx.destination);
    }
  }
  closeVolume.onclick=()=>{volumePanel.style.display="none";};

  let volTimer=null;
  canvas.addEventListener("touchstart",e=>{
    for(const t of e.touches){
      if(t.clientY<80 && t.clientX<80){
        if(!volTimer){
          volTimer=setTimeout(()=>{volumePanel.style.display="flex";},3000);
        }
      }
    }
  });
  canvas.addEventListener("touchend",()=>{clearTimeout(volTimer);volTimer=null;});

  volumeSlider.oninput=e=>{
    volume=parseFloat(e.target.value);
    if(masterGain) masterGain.gain.value=volume;
  };

  /* ---- Sound ---- */
  const SCALE=[261.63,293.66,329.63,349.23,392,440,493.88,523.25];
  let wheelIndex=0,bubbleIndex=0;
  function playNote(freq,dur=0.32){
    ensureAudio();
    const osc=audioCtx.createOscillator(), gain=audioCtx.createGain();
    osc.type="sine"; osc.frequency.setValueAtTime(freq,audioCtx.currentTime);
    gain.gain.setValueAtTime(0.22,audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+dur);
    osc.connect(gain); gain.connect(masterGain);
    osc.start(); osc.stop(audioCtx.currentTime+dur);
  }

  /* ---- Wheel ---- */
  const colors=["#ff007f","#ff7f00","#ffff00","#00ff00","#00ffff","#0000ff","#8b00ff"];
  let radius=120, angle=0,spinSpeed=0,friction=0.985;
  let lastSlice=null,lastSound=0;
  function resizeCanvas(){canvas.width=innerWidth;canvas.height=innerHeight;radius=Math.min(innerWidth,innerHeight)*0.45;}
  window.onresize=resizeCanvas;resizeCanvas();

  function drawWheel(){
    ctx.save(); ctx.translate(canvas.width/2,canvas.height/2); ctx.rotate(angle);
    ctx.beginPath(); ctx.arc(0,0,radius+12,0,Math.PI*2);
    ctx.strokeStyle="white"; ctx.lineWidth=4; ctx.shadowColor="white"; ctx.shadowBlur=25; ctx.stroke();
    for(let i=0;i<colors.length;i++){
      ctx.beginPath(); ctx.moveTo(0,0);
      ctx.arc(0,0,radius,(i*2*Math.PI)/colors.length,((i+1)*2*Math.PI)/colors.length);
      ctx.closePath(); ctx.fillStyle=colors[i]; ctx.shadowColor=colors[i]; ctx.shadowBlur=20; ctx.fill();
    }
    ctx.restore();
  }

  function wheelSoundStep(){
    const now=performance.now();
    const normalized=((angle%(2*Math.PI))+2*Math.PI)%(2*Math.PI);
    const currentSlice=Math.floor((normalized/(2*Math.PI))*colors.length);
    if(currentSlice!==lastSlice && Math.abs(spinSpeed)>0.05 && now-lastSound>120){
      if(spinSpeed>0){
        playNote(SCALE[wheelIndex]); wheelIndex=(wheelIndex+1)%SCALE.length;
      } else {
        wheelIndex=(wheelIndex-1+SCALE.length)%SCALE.length;
        playNote(SCALE[wheelIndex]);
      }
      lastSlice=currentSlice; lastSound=now;
    }
  }

  let active=null,isDragging=false,lastAngle=0,lastTime=0;
  function getAngle(x,y){const cx=canvas.width/2,cy=canvas.height/2;return Math.atan2(y-cy,x-cx);}
  function pointerDown(e){
    const id=e.pointerId??e.changedTouches[0].identifier;
    const rect=canvas.getBoundingClientRect();
    const x=(e.clientX??e.touches[0].clientX)-rect.left;
    const y=(e.clientY??e.touches[0].clientY)-rect.top;
    const dx=x-canvas.width/2,dy=y-canvas.height/2;
    if(Math.hypot(dx,dy)<=radius && active===null){
      active=id;isDragging=true;lastAngle=getAngle(x,y);lastTime=Date.now();spinSpeed=0;
    }
    popBubbleAt(x,y);
  }
  function pointerMove(e){
    const id=e.pointerId??(e.touches&&e.touches[0].identifier);
    if(!isDragging||id!==active)return;
    const rect=canvas.getBoundingClientRect();
    const x=(e.clientX??e.touches[0].clientX)-rect.left;
    const y=(e.clientY??e.touches[0].clientY)-rect.top;
    const a=getAngle(x,y);const now=Date.now();const delta=a-lastAngle;
    angle+=delta;spinSpeed=delta/((now-lastTime)/1000);
    lastAngle=a;lastTime=now;
  }
  function pointerUp(e){const id=e.pointerId??e.changedTouches[0].identifier;if(id===active){isDragging=false;active=null;}}
  canvas.onpointerdown=pointerDown;canvas.onpointermove=pointerMove;canvas.onpointerup=pointerUp;canvas.onpointercancel=pointerUp;

  /* ---- Bubbles ---- */
  let bubbles=[],MAX=12;
  function createBubble(){const r=40+Math.random()*20;const x=Math.random()*(canvas.width-r*2)+r;const y=-r-Math.random()*canvas.height*0.3;
    return{x,y,r,speed:0.5+Math.random()*0.6,hue:Math.random()*360,popped:false};}
  function popBubbleAt(x,y){
    for(let i=0;i<bubbles.length;i++){const b=bubbles[i];
      if(!b.popped&&Math.hypot(b.x-x,b.y-y)<b.r){b.popped=true;playNote(SCALE[bubbleIndex],0.24);
        bubbleIndex=(bubbleIndex+1)%SCALE.length;bubbles[i]=createBubble();break;}
    }
  }
  setInterval(()=>{if(bubbles.length<MAX)bubbles.push(createBubble());},1000);
  function drawBubbles(){
    for(let i=0;i<bubbles.length;i++){const b=bubbles[i];if(b.popped)continue;
      b.hue=(b.hue+0.5)%360;const g=ctx.createRadialGradient(b.x,b.y,b.r*0.2,b.x,b.y,b.r);
      g.addColorStop(0,"rgba(255,255,255,0.05)");
      g.addColorStop(0.6,`hsla(${b.hue},100%,75%,0.15)`);
      g.addColorStop(0.9,`hsla(${(b.hue+120)%360},100%,70%,0.35)`);
      g.addColorStop(1,"rgba(255,255,255,0.55)");
      ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fillStyle=g;ctx.fill();
      b.y+=b.speed;if(b.y-b.r>canvas.height)bubbles[i]=createBubble();}
  }

  /* ---- Loop ---- */
  function animate(){if(!isDragging){angle+=spinSpeed;spinSpeed*=friction;}wheelSoundStep();
    ctx.clearRect(0,0,canvas.width,canvas.height);drawBubbles();drawWheel();requestAnimationFrame(animate);}
  for(let i=0;i<MAX/2;i++)bubbles.push(createBubble());
  animate();
  </script>
</body>
</html>
